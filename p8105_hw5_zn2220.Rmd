---
title: "p8105_hw5_zn2220"
author: "Ziang Niu"
date: "2025-10-31"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)

set.seed(235)
```

# Problem 1

## Write a function that, for a fixed group size, randomly draws “birthdays” for each person; checks whether there are duplicate birthdays in the group; and returns TRUE or FALSE based on the result.

Write the function.

```{r}
duplicate_birthday <- function(n) {
birthdays <- sample(1:365, size = n, replace = TRUE)
any(duplicated(birthdays))
}
```

Check returns.

```{r}
duplicate_birthday(2)
duplicate_birthday(23)
duplicate_birthday(50)
```

## Next, run this function 10000 times for each group size between 2 and 50. For each group size, compute the probability that at least two people in the group will share a birthday by averaging across the 10000 simulation runs. Make a plot showing the probability as a function of group size, and comment on your results.

Create a tibble.

```{r}
n <- 2:50
repeats <- 10000

prob <- numeric(length(n))

for (i in seq_along(n)) {
  group_size <- n[i]
  prob[i] <- mean(replicate(repeats, duplicate_birthday(group_size)))
}

prob_list <- tibble(n = n, probability = prob)

```

draw a plot.

```{r}
ggplot(prob_list, aes(x = n, y = prob)) +
geom_line() +
geom_point() +
scale_x_continuous(breaks = seq(0, 50, by = 5)) +
labs(title = "Probability that at least two people share a birthday",
x = "Group size (n)",
y = "Probability") +
theme_minimal(base_size = 12)
```

As n increases, the probability of shared birthdays rises quickly; at around n = 23, it’s already about 0.5.

# Problem 2

```{r}
run_t_sim <- function(mu, n = 30, sigma = 5, repeats = 5000, alpha = 0.05) {
tibble(rep = 1:repeats) %>%
mutate(
data = map(rep, ~ rnorm(n, mean = mu, sd = sigma)),
test = map(data, ~ broom::tidy(t.test(.x, mu = 0))),
estimate = map_dbl(test, "estimate"),
p_value = map_dbl(test, "p.value"),
reject = p_value < alpha
)
}

mus <- 1:6

results_p2 <- data.frame(
  mu = numeric(),
  power = numeric(),
  mean_est_all = numeric(),
  mean_est_reject = numeric()
)

for (m in mus) {
  df <- run_t_sim(mu = m)
  
  power <- mean(df$reject)
  mean_est_all <- mean(df$estimate)
  mean_est_reject <- if (any(df$reject)) mean(df$estimate[df$reject]) else NA
  
  results_p2 <- rbind(
    results_p2,
    data.frame(
      mu = m,
      power = power,
      mean_est_all = mean_est_all,
      mean_est_reject = mean_est_reject
    )
  )
}


results_p2

```

```{r}
ggplot(results_p2, aes(x = mu, y = power)) +
geom_line() + geom_point() +
labs(title = "Power of one-sample t-test vs effect size",
x = "True mean μ",
y = "Power (proportion rejected)") +
theme_minimal(base_size = 12)
```

```{r}
results_p2_long <- results_p2 %>%
pivot_longer(cols = c(mean_est_all, mean_est_reject),
names_to = "which", values_to = "mean_est")

ggplot(results_p2_long, aes(x = mu, y = mean_est, color = which)) +
geom_line() + geom_point() +
labs(title = "Average μ̂ across all vs only rejected samples",
x = "True μ",
y = "Average estimate μ̂",
color = "Sample type") +
theme_minimal(base_size = 12)
```
